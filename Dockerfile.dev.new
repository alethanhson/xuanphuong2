# Sử dụng Node.js bản mới nhất cho môi trường development
FROM node:20-alpine

# Cài đặt các gói cần thiết
RUN apk add --no-cache libc6-compat bash curl

# Thiết lập thư mục làm việc
WORKDIR /app

# Sao chép package.json và package-lock.json
COPY package.json package-lock.json* ./

# Cài đặt các dependencies với npm ci để đảm bảo đúng phiên bản
RUN npm ci
# Kiểm tra xem next đã được cài đặt đúng chưa
RUN ls -la node_modules/.bin/
# Thêm .bin vào PATH để có thể tìm thấy next
ENV PATH /app/node_modules/.bin:$PATH

# Thiết lập biến môi trường
ENV NEXT_TELEMETRY_DISABLED 1
ENV NODE_ENV development

# Mở cổng 3000
EXPOSE 3000

# Sử dụng hostname 0.0.0.0 thay vì localhost
ENV HOSTNAME 0.0.0.0
ENV PORT 3000

# Khởi động ứng dụng ở chế độ development sử dụng npx
CMD ["npx", "next", "dev"] 